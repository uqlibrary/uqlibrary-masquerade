<!--
Element providing the library main masquerade component

##### Example

    <uqlibrary-masquerade></uqlibrary-masquerade>

    <script>
    (function () {

      window.addEventListener('polymer-ready', function() {

        var masquerade = document.querySelector('uqlibrary-masquerade');

        masquerade.masquerade = [

          ];
      });
    }());
  </script>

@element uqlibrary-masquerade
@blurb Element providing the library masquerade ability for staff to diagnose end user issues
@status alpha
@homepage http://uqlibrary.github.io/uqlibrary-masquerade
-->

<link rel="import" href="../uqlibrary-elements/0.5.4/lib/vulcanized.html">



<polymer-element name="uqlibrary-masquerade" layout center attributes="masquerade">
  <template>
      <link rel="stylesheet" href="../uqlibrary-elements/resources/theme/element.css">
    <uqlibrary-ga id="ga" appName="masquerade"></uqlibrary-ga>
    <uqlibrary-api-account id="account"></uqlibrary-api-account>
    <core-drawer-panel id="drawerPanel" class="drawer" drawerWidth="256px" responsiveWidth="768px">
      <core-header-panel drawer>
        <uqlibrary-menu account="{{user}}"></uqlibrary-menu>
      </core-header-panel>

      <core-header-panel main class="main">
        <core-toolbar>
          <paper-icon-button id="toolBarLeftButton" icon="menu" core-drawer-toggle></paper-icon-button>
          <h1 flex id="toolbar-page-title">Library masquerade</h1>
        </core-toolbar>

        <div id="content">

          <div id="cards">
              <template if="{{user.canMasquerade}}">
            <paper-shadow class="card masqueradeCard" z="1">
              <h2 class="title">Careful...</h2>
              <p>You will effectively become the user you enter here, and changes you make will apply to his or her account!</p>

                <div id="masquerade">
                    <paper-input-decorator label="Username or student number">
                        <input is="core-input">
                    </paper-input-decorator>
                </div>
                <div horizontal layout end-justified id="masqueradeButton">
                    <core-tooltip noarrow id="masqueradeTooltip" class="fancy" position="bottom" label="Are you completely sure you want to do this?">
                    <paper-button affirmative class="colored" on-tap="{{go}}">Masquerade as this user</paper-button>
                        </core-tooltip>
                </div>
            </paper-shadow>
              </template>

          <template if="{{!user.canMasquerade}}">
              <paper-shadow class="card masqueradeCard" z="1">
                  <p>According to our records, you don't have the ability to use masquerade.</p>
              </paper-shadow>
          </template>

          </div>

        </div>
      </core-header-panel>

    </core-drawer-panel>

  </template>

  <script>
    Polymer('uqlibrary-hours', {
      go: function (e) {
        document.location.href = "https://www.library.uq.edu.au/uqlais/masquerade?" +
        "user=" + this.user + "&" +
        "return=" + window.btoa(window.location.href);
      },

      ready: function() {
        var that = this;
        this.$.account.addEventListener('uqlibrary-api-account-loaded', function(e) {
            if (e.detail.hasSession) {
                that.user = e.detail;
            } else {
              alert("hi!");
              that.$.account.login(document.location.href);
            }
        });

        this.$.account.get();
      }
    });
  </script>

</polymer-element>